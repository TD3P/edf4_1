<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDF4.1 ãƒ‡ãƒãƒƒã‚°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .debug-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #007acc;
        }
        .error { border-left-color: #e74c3c; }
        .success { border-left-color: #27ae60; }
        .warning { border-left-color: #f39c12; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow: auto; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007acc; color: white; }
        .btn-test { background: #27ae60; color: white; }
    </style>
</head>
<body>
    <h1>ğŸ”§ EDF4.1 æ­¦å™¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ - ãƒ‡ãƒãƒƒã‚°</h1>
    
    <div class="debug-box">
        <h3>ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ãƒã‚§ãƒƒã‚¯</h3>
        <button class="btn-test" onclick="checkFiles()">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯</button>
        <div id="fileCheck"></div>
    </div>

    <div class="debug-box">
        <h3>ğŸ“„ JSON ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</h3>
        <button class="btn-test" onclick="testJSON()">JSONã‚’èª­ã¿è¾¼ã¿</button>
        <div id="jsonTest"></div>
    </div>

    <div class="debug-box">
        <h3>ğŸ¨ CSS èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</h3>
        <button class="btn-test" onclick="testCSS()">CSSã‚’ãƒã‚§ãƒƒã‚¯</button>
        <div id="cssTest"></div>
    </div>

    <div class="debug-box">
        <h3>âš™ï¸ JavaScript ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°</h3>
        <div id="errorLog"></div>
    </div>

    <div class="debug-box">
        <h3>ğŸš€ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•ãƒ†ã‚¹ãƒˆ</h3>
        <button class="btn-primary" onclick="window.open('index.html', '_blank')">ã‚¢ãƒ—ãƒªã‚’é–‹ã</button>
        <button class="btn-test" onclick="testApp()">ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ ãƒ†ã‚¹ãƒˆ</button>
        <div id="appTest"></div>
    </div>

    <script>
        // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’åé›†
        const errorLog = document.getElementById('errorLog');
        let errors = [];

        window.addEventListener('error', (e) => {
            errors.push({
                message: e.message,
                filename: e.filename,
                lineno: e.lineno,
                colno: e.colno
            });
            updateErrorLog();
        });

        function updateErrorLog() {
            if (errors.length === 0) {
                errorLog.innerHTML = '<p style="color: green;">âœ… ã‚¨ãƒ©ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
            } else {
                errorLog.innerHTML = '<p style="color: red;">âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã¾ã™:</p>' +
                    errors.map(err => `<pre>${err.message} (${err.filename}:${err.lineno}:${err.colno})</pre>`).join('');
            }
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ãƒã‚§ãƒƒã‚¯
        async function checkFiles() {
            const fileCheck = document.getElementById('fileCheck');
            const files = ['styles.css', 'script.js', 'weaponData.json'];
            let results = [];

            for (const file of files) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    results.push(`âœ… ${file}: ${response.ok ? 'OK' : 'ERROR'} (${response.status})`);
                } catch (error) {
                    results.push(`âŒ ${file}: ERROR - ${error.message}`);
                }
            }

            fileCheck.innerHTML = '<pre>' + results.join('\n') + '</pre>';
        }

        // JSONèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
        async function testJSON() {
            const jsonTest = document.getElementById('jsonTest');
            
            try {
                const response = await fetch('weaponData.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                const stats = {};
                let total = 0;
                
                Object.keys(data).forEach(classKey => {
                    const classData = data[classKey];
                    let classTotal = 0;
                    Object.keys(classData.categories).forEach(cat => {
                        classTotal += classData.categories[cat].length;
                    });
                    stats[classData.name] = classTotal;
                    total += classTotal;
                });
                
                jsonTest.innerHTML = `
                    <div class="success">
                        <p>âœ… JSONèª­ã¿è¾¼ã¿æˆåŠŸ!</p>
                        <pre>${JSON.stringify(stats, null, 2)}</pre>
                        <p><strong>ç·æ­¦å™¨æ•°: ${total}</strong></p>
                    </div>
                `;
            } catch (error) {
                jsonTest.innerHTML = `
                    <div class="error">
                        <p>âŒ JSONèª­ã¿è¾¼ã¿å¤±æ•—</p>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }

        // CSSèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
        function testCSS() {
            const cssTest = document.getElementById('cssTest');
            const links = document.getElementsByTagName('link');
            let cssLinks = Array.from(links).filter(link => link.rel === 'stylesheet');
            
            if (cssLinks.length === 0) {
                // å¤–éƒ¨CSSã‚’ãƒ†ã‚¹ãƒˆ
                const testLink = document.createElement('link');
                testLink.rel = 'stylesheet';
                testLink.href = 'styles.css';
                testLink.onload = () => {
                    cssTest.innerHTML = '<div class="success">âœ… styles.css èª­ã¿è¾¼ã¿æˆåŠŸ</div>';
                };
                testLink.onerror = () => {
                    cssTest.innerHTML = '<div class="error">âŒ styles.css èª­ã¿è¾¼ã¿å¤±æ•—</div>';
                };
                document.head.appendChild(testLink);
            } else {
                cssTest.innerHTML = '<div class="warning">âš ï¸ CSSã¯æ—¢ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™</div>';
            }
        }

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
        async function testApp() {
            const appTest = document.getElementById('appTest');
            appTest.innerHTML = '<p>ğŸ”„ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</p>';
            
            try {
                // 1. JSONãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
                const response = await fetch('weaponData.json');
                const weaponData = await response.json();
                
                // 2. DOMè¦ç´ ä½œæˆãƒ†ã‚¹ãƒˆ
                const testDiv = document.createElement('div');
                testDiv.style.cssText = `
                    border: 2px solid #007acc;
                    padding: 20px;
                    margin: 10px 0;
                    border-radius: 10px;
                    background: white;
                `;
                
                // 3. ã‚µãƒ³ãƒ—ãƒ«æ­¦å™¨ãƒªã‚¹ãƒˆä½œæˆ
                const rangerWeapons = weaponData.ranger.categories['ã‚¢ã‚µãƒ«ãƒˆãƒ©ã‚¤ãƒ•ãƒ«'].slice(0, 3);
                testDiv.innerHTML = `
                    <h4>ğŸ”« ${weaponData.ranger.name} - ã‚¢ã‚µãƒ«ãƒˆãƒ©ã‚¤ãƒ•ãƒ« (ã‚µãƒ³ãƒ—ãƒ«)</h4>
                    ${rangerWeapons.map(weapon => `
                        <div style="padding: 10px; margin: 5px; background: #f8f9fa; border-radius: 5px; cursor: pointer;"
                             onclick="this.style.background=this.style.background==='rgb(0, 184, 148)'?'#f8f9fa':'#00b894'; this.style.color=this.style.color==='white'?'black':'white';">
                            ${weapon}
                        </div>
                    `).join('')}
                `;
                
                appTest.innerHTML = '<div class="success">âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œãƒ†ã‚¹ãƒˆæˆåŠŸ</div>';
                appTest.appendChild(testDiv);
                
            } catch (error) {
                appTest.innerHTML = `
                    <div class="error">
                        <p>âŒ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆå¤±æ•—</p>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }

        // åˆæœŸåŒ–
        updateErrorLog();
        
        // 5ç§’å¾Œã«è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        setTimeout(() => {
            console.log('è‡ªå‹•ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            checkFiles();
            setTimeout(testJSON, 1000);
        }, 1000);
    </script>
</body>
</html>